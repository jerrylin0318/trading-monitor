<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Monitor</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <!-- Header -->
    <div class="header">
        <h1>📊 Trading Monitor</h1>
        <div class="header-right">
            <div class="controls">
                <span id="ib-status">
                    <span class="status-dot disconnected" id="ib-dot"></span>
                    <span id="ib-label" style="font-size:13px;color:var(--text-secondary)">IB 未連線</span>
                </span>
                <button class="btn btn-sm" id="btn-connect" onclick="toggleConnect()">連線</button>
                <span style="color:var(--border)">|</span>
                <span class="status-dot" id="monitor-dot"></span>
                <span id="monitor-label" style="font-size:13px;color:var(--text-secondary)">未啟動</span>
                <button class="btn btn-sm btn-success" id="btn-monitor" onclick="toggleMonitor()">啟動監控</button>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Account Info -->
        <div class="card">
            <div class="card-header">💰 帳戶資訊</div>
            <div class="card-body">
                <div class="account-grid" id="account-grid">
                    <div class="account-item">
                        <div class="label">淨值</div>
                        <div class="value" id="acc-equity">--</div>
                    </div>
                    <div class="account-item">
                        <div class="label">可用資金</div>
                        <div class="value" id="acc-available">--</div>
                    </div>
                    <div class="account-item">
                        <div class="label">購買力</div>
                        <div class="value" id="acc-buying-power">--</div>
                    </div>
                    <div class="account-item">
                        <div class="label">未實現盈虧</div>
                        <div class="value" id="acc-unrealized-pnl">--</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Positions -->
        <div class="card">
            <div class="card-header">📋 持倉部位</div>
            <div class="card-body">
                <div id="positions-container">
                    <div class="empty-state">無持倉</div>
                </div>
            </div>
        </div>

        <!-- Watch List -->
        <div class="card">
            <div class="card-header">
                👁️ 觀察清單
                <button class="btn btn-sm btn-primary" onclick="showAddWatch()">+ 新增</button>
            </div>
            <div class="card-body">
                <!-- Add form (hidden by default) -->
                <div id="add-watch-form" style="display:none; margin-bottom:16px;">
                    <div class="form-row">
                        <div class="form-group">
                            <label>標的代碼</label>
                            <input type="text" id="w-symbol" placeholder="SPY, MNQ...">
                        </div>
                        <div class="form-group">
                            <label>類型</label>
                            <select id="w-sectype">
                                <option value="STK">股票 (STK)</option>
                                <option value="FUT">期貨 (FUT)</option>
                                <option value="IND">指數 (IND)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>交易所</label>
                            <input type="text" id="w-exchange" value="SMART">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>MA 週期</label>
                            <input type="number" id="w-ma-period" value="21" min="2">
                        </div>
                        <div class="form-group">
                            <label>N 點</label>
                            <input type="number" id="w-n-points" value="5" step="0.1" min="0">
                        </div>
                        <div class="form-group">
                            <label>幣別</label>
                            <input type="text" id="w-currency" value="USD">
                        </div>
                        <div class="form-group" style="flex:0;">
                            <label>&nbsp;</label>
                            <div style="display:flex;gap:4px;">
                                <button class="btn btn-success btn-sm" onclick="addWatch()">確定</button>
                                <button class="btn btn-sm" onclick="hideAddWatch()">取消</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="watch-list">
                    <div class="empty-state">尚無觀察標的，點擊「+ 新增」開始</div>
                </div>
            </div>
        </div>

        <!-- Signals -->
        <div class="card">
            <div class="card-header">
                🔔 信號記錄
                <button class="btn btn-sm" onclick="clearSignals()">清除</button>
            </div>
            <div class="card-body">
                <div id="signals-container">
                    <div class="empty-state">尚無信號</div>
                </div>
            </div>
        </div>

        <!-- Options Panel (appears on signal) -->
        <div class="card full-width" id="options-card" style="display:none;">
            <div class="card-header">
                ⚡ 選擇權交易面板
                <button class="btn btn-sm" onclick="closeOptions()">關閉</button>
            </div>
            <div class="card-body" id="options-body">
            </div>
        </div>

        <!-- Log -->
        <div class="card full-width">
            <div class="card-header">📜 日誌</div>
            <div class="card-body">
                <div class="log-container" id="log-container"></div>
            </div>
        </div>
    </div>

    <!-- Toast container -->
    <div class="toast-container" id="toast-container"></div>

    <script src="/static/app.js"></script>
</body>
</html>
